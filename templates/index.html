<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; text-align: center; padding: 20px; background: #2c3e50; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin:0;}
        .card { background: white; color: black; padding: 40px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); width: 100%; max-width: 700px; }
        .big { font-size: 3em; color: #2980b9; font-weight: bold; margin: 10px 0; }
        .status { font-size: 1.5em; color: #7f8c8d; }
        .alert { color: #c0392b; font-weight: bold; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .btn { display: inline-block; padding: 10px 20px; background: #bdc3c7; color: #333; text-decoration: none; border-radius: 5px; margin-top:20px; font-weight: bold; border: none; cursor: pointer;}
        .scanner-icon { font-size: 80px; margin: 20px 0; }
        .btn-reset { background-color: #ecf0f1; color: #2c3e50; margin-right: 10px; }
        
        .product-img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üè≠ STOCK MONITOR</h1>
        <hr>
        <div id="display">
            {% if result.status == 'waiting' %}
                <p class="status">Waiting for Scan...</p>
                <div class="scanner-icon">üî´</div>
            
            {% elif result.status == 'found' %}
                <h2 style="color:#27ae60">‚úÖ ‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
                
                <img src="/static/images/{{ result.code }}.jpg" class="product-img" onerror="this.style.display='none'">

                <div class="big">{{ result.data.name }}</div>
                <p class="status">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <strong>{{ result.data.qty }}</strong> ‡∏ä‡∏¥‡πâ‡∏ô</p>
                
                {% if result.data.qty <= result.data.min %}
                    <p class="alert">üö® ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Ç‡∏≠‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î! (‡∏à‡∏∏‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: {{ result.data.min }})</p>
                {% endif %}
            
            {% else %}
                <h2 style="color:#c0392b">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <p class="status">‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô: {{ result.code }}</p>
                <div class="scanner-icon">‚ùì</div>
            {% endif %}
        </div>
        
        <br>
        <a href="/reset" class="btn btn-reset">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</a>
        
        <a href="/dashboard" class="btn" style="background-color: #3498db; color: white;">üìä ‡∏î‡∏π Dashboard</a>
        
        <a href="/admin" class="btn">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
    </div>

    <script>
        let barcodeBuffer = "";
        let reading = false;
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (barcodeBuffer.length > 0) {
                    window.location.href = "/scan/" + barcodeBuffer; 
                    barcodeBuffer = "";
                }
            } else {
                if (event.key.length === 1) { barcodeBuffer += event.key; }
            }
            if(!reading) {
                reading = true;
                setTimeout(() => { barcodeBuffer = ""; reading = false; }, 200);
            }
        });
    </script>
</body>
</html>